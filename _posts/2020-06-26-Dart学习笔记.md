---
layout:     post
title:      Dart学习笔记

subtitle:   A note of a tour of the Dart language🐱
date:       2020-06-26
header-img: img/post-bg-debug.png
catalog:    false
tag:
    - dart
---

- 变量、运算符、库
- dart核心库
- dart编程语言规范

## 简单的dart程序

```dart
    // 定义一个函数
    printInteger(int aNumber) {
        print('The number is $aNUmber.');// 打印到控制台
    }
    // main func
    // 应用从这里开始执行
    main() {
        var number = 42; 
        printInteger(number);
    }
```

- ```//```单行注释，dart同样支持多行注释和文档注释
-  数据类型： 
  - int 
  - String
  - List
  - bool
  - print(): 便利输出方式
  - ```$variableName```或```${expression}```
  - main() : 主程序
  - var 变量，通过这种方式定义变量不需要指定变量类型

## 重要概念

-  在学习dart语言时，应该基于一下事实和概念：
  - 任何保存在变量中的都是一个对象，并且所有的对象都是对应一个类的实例。无论是数字、函数和null都是一个对象，所有对象都继承自Object类。
  
  - 尽管 Dart 是强类型的，但是 Dart 可以推断类型，所以类型注释是可选的。 在上面的代码中， number 被推断为 int 类型。 如果要明确说明不需要任何类型， 需要使用特殊类型 dynamic。

  - Dart 支持泛型，如 List <int> （整数列表）或 List <dynamic> （任何类型的对象列表）。

  - Dart 支持顶级函数（例如 main（） ）， 同样函数绑定在类或对象上（分别是 静态函数 和 实例函数 ）。 以及支持函数内创建函数 （ 嵌套 或 局部函数 ）。

  - Dart支持顶级变量，同样变量绑定在类或对象上（静态变量和实例变量）。实例变量有时称为字段或属性。

  - 与java不同，Dart没有关键字“public”, “protected”, “private”。若标识符一下划线（_）开头，则它相对于库是私有的。

  - 标识符 以字母或下划线（_）开头，后跟任意字母和数字组合。

  - Dart 语法中包含 表达式（ expressions ）（有运行时值）和 语句（ statements ）（没有运行时值）。 例如，条件表达式 condition ? expr1 : expr2 的值可能是 expr1 或 expr2 。 将其与 if-else 语句 相比较，if-else 语句没有值。 一条语句通常包含一个或多个表达式，相反表达式不能直接包含语句。

  - Dart 工具提示两种类型问题：警告_和_错误。 警告只是表明代码可能无法正常工作，但不会阻止程序的执行。 错误可能是编译时错误或者运行时错误。 编译时错误会阻止代码的执行; 运行时错误会导致代码在执行过程中引发 [异常]（#exception）。

## 关键字

- abstract 
- dynamic
- implements
- show
- as
- else
- import
- static
- assert
- enum
- in
- super
- async
- export
- interface
- switch
- awit
- extends
- is
- sync
- break
- external
- library
- this
- case
- factory
- mixin
- throw
- catch
- false
- new
- true
- class
- final
- null
- try
- const
- finally
- on
- typedef
- continue
- for
- operator
- var
- covariant
- Function
- part
- void
- default
- get
- rethrow
- while
- deferred
- hide
- return
- with
- do
- if
- set
- yield


- 避免使用这些单词作为标识符，
  - 上下文关键字
  - 内置标识符：为了简化将 JavaScript 代码移植到 Dart 的工作， 这些关键字在大多数地方都是有效的标识符， 但它们不能用作类或类型名称，也不能用作 import 前缀。
  - 异步支持

## 变量

```dart
var name = 'Bob';
```

- 变量仅存储对象引用，这里的变量是name存储了一个String类型的对象引用，
- 对象类型或动态类型

```dart
dynamic name = 'Bon';
```

```dart
String name = "Bon";
```

## 默认值

- 未初始化的变量默认值是null， dart中一切都是对象，数字类型也不例外。

```dart
int lineCount;
assert(lineCount == null);

```

- 在生产环境代码中assert()会被忽略，不会调用。

## Final 和 Const

- 常量，Final变量的值只能被设置一次；Const变量在编译时就已经固定。

```dart
final name = 'bon';
final String nickname = 'bobby';
name = 'alice'; // error
```

```dart
const bar = 100000;
const double = 1.01325 * bar;

var foo = const [];
final bar1 = const [];
const baz = [];

foo = [1, 2, 3];
baz = [42] // error
```

## 内建类型

- Number
- String
- Boolean
- List(也称为Array);
- Map
- Set
- Rune(用于在字符串中表示Unicode字符)
- Symbol

- 因为在 Dart 所有的变量终究是一个对象（一个类的实例）， 所以变量可以使用 构造涵数 进行初始化。 一些内建类型拥有自己的构造函数。 例如， 通过 Map() 来构造一个 map 变量。

### Number

- int 
- double

```dart
// String -> int
var one = int.parse('1');
assert(one ==1);

// String -> double
var onePointOne = double.parse('1.1');
assert(onePointone == 1.1);

// int -> String
String oneAsString = 1.toString();
assert(oneAsString == '1');

// double -> String
String piAsString = 3.14159.toStringAsFixed(2);
assert(piAsString == '3.14');

```

### String & Boolean

- 字符串可以通过${expression}的方式内嵌表达式，若表达式是一个标识符，则{}可以省略。
- == 运算符用来测试两个对象是否相等，若两个字符包含了相同的编码序列，那么这两个字符串相等那个。
- Dart 使用 bool 类型表示布尔值。 Dart 只有字面量 true and false 是布尔类型， 这两个对象都是编译时常量。


### List

- 在Dart中的Array就是List对象，通常称之为list

```dart
var list = [1,2,3];
```

- 在List字面量之前添加const 关键字，可以定义List类型的编译时常量

```dart
var constList = const [1,2,3];
// constantList[1] = 1; // 取消注释会引起错误。
```

- 更多信息参考泛型和集合.

### Set

- 在 Dart 中 Set 是一个元素唯一且无需的集合。 Dart 为 Set 提供了 Set 字面量和 Set 类型。

```dart
var halogens = {'f', 'ch', 'br', 'iod'};

var names = <String>{};
// Set<String> names = {}; // 这样也是可以的。
// var names = {}; // 这样会创建一个 Map ，而不是 Set 。
```

```dart
var elements = <String>{};
elements.add('hello');
elements.addall(halog);
```

### Map

- 通常来说， Map 是用来关联 keys 和 values 的对象。 keys 和 values 可以是任何类型的对象。在一个 Map 对象中一个 key 只能出现一次。 但是 value 可以出现多次。 Dart 中 Map 通过 Map 字面量 和 Map 类型来实现。

```dart
var gifts = {
  'first': 'partridge',
};

var nobleGase = {
  2: 'hello',
  3: 'nemo',
  18: 'argon'
};

// 使用Map构造函数创建
var gifts = Map();
gifts['first'] = 'partridge';

var nobleGases = Map();
nobleGases[2] = 'helium';
nobleGases[10] = 'neon';
nobleGases[18] = 'argon';
```

### Rune

- 在Dart中，Rune用来表示字符串中的UTF-32编码字符。

```dart
main() {
  var clapping = '\u{1f44f}';
  print(clapping);
  print(clapping.codeUnits);
  print(clapping.runes.toList());

  Runes input = new Runes(
      '\u2665  \u{1f605}  \u{1f60e}  \u{1f47b}  \u{1f596}  \u{1f44d}');
  print(new String.fromCharCodes(input));
}
```

- 谨慎使用 list 方式操作 Rune 。 这种方法很容易引发崩溃， 具体原因取决于特定的语言，字符集和操作。

### Symbol

- 一个 Symbol 对象表示 Dart 程序中声明的运算符或者标识符。 你也许永远都不需要使用 Symbol ，但要按名称引用标识符的 API 时， Symbol 就非常有用了。 因为代码压缩后会改变标识符的名称，但不会改变标识符的符号。 通过字面量 Symbol ，也就是标识符前面添加一个 # 号，来获取标识符的 Symbol 。

## Function

- Dart是一门真正面向对象的语言，其中的函数也是对象，并且有它的类型Function。

```dart
bool isNobel(int atomicNumber) {
  return _nobelGases[atomicNUmber] != null;
}
```

- 省略类型声明，函数依旧是可以正常使用的

- 箭头函数亦可使用

```dart
bool isNobel(int atomicNumber) => _nobelGase[atomicNumber] != null;
```

- => expr 语法是 { return expr; } 的简写。 => 符号 有时也被称为 箭头 语法。

- 使用@required注释表示参数是required性质的命名参数，该方式可以在任何 Dart 代码中使用

```dart
const Scrollbar({key key, @required Widget child})
```

### 位置可选参数

- 将参数放到[]中标记参数是可选的：

```dart
String say(String from, String msg, [String device]) {
  var result = '$from says $msg';
  if (device != null) {
    result = '$result with a $device';
  }
  return result;
}
```

### 默认参数值

- 在定义方法的时候，可以使用 = 来定义可选参数的默认值。 默认值只能是编译时常量。 如果没有提供默认值，则默认值为 null。

```dart
// 设置 [bold] 和 [hidden] 标志 ...
void enableFlags({bool bold = false, bool hidden = false}) {...}

// bold 值为 true; hidden 值为 false.
enableFlags(bold: true);
```

### main()

- 任何应用都必须有一个顶级 main() 函数，作为应用服务的入口。 main() 函数返回值为空，参数为一个可选的 List<String>

### 函数是一等对象

- 一个函数可以作为另一个函数的参数

```dart
void printElement(int elemnt) {
  print(element);
}

var list = [1, 2, 3];

// 将printElement函数作为参数传递
list.forEach(printElement);

// 将一个函数赋值给一个变量
var loudify = (msg) => '!!! ${msg.toUpperCase()} !!!';
assert(loudify('hello') === '!!! HELLO !!!')；
```

### 匿名函数

```dart
var list = ['apples', 'bananas', 'oranges'];
list.forEach((item) {
  print('${list.indexOf(item)}: $item');
})

// 等价于
list.forEach((item) => print('${list.indexOf(item)}: $item'));
```

### 词法作用域

- Dart是一门词法作用域的编程语言，就意味着变量的作用域是固定的，简单说变量的作用域在编写代码的时候就是已经确定了。花括号内的就是变量可见的作用域。

```dart
bool topLevel = true;

void main() {
  var insideMain = true;

  void myFunction() {
    var insideFunction = true;

    void nestedFunction() {
      var insideNestedFunction = true;

      assert(topLevel);
      assert(insideMain);
      assert(insideFunction);
      assert(insideNestedFunction);
    }
  }
}
```

- 注意 nestedFunction() 可以访问所有的变量， 一直到顶级作用域变量。

### 词法闭包

- 闭包即一个函数对象，即使函数对象的调用在它原始作用域之外，依然能够访问在它词法作用域内的变量。
- 函数可以封闭定义到它作用域内的变量。

```dart
// 返回一个函数，返回的函数参数与[addBy]相加
Function makeAdder(num addBy) {
  return (num i) => addBy + i;
}

void main() {
  // 创建一个加2的函数
  var add2 = makeAdder(2);

  // 创建一个加4的函数
  var add4 = makeAdder(4);

  assert(add2(3) == 5);
  assert(add4(3) == 7);
}
```

### 测试函数是否相等

```dart
void foo() {} // 顶级函数

class A {
  static void bar() {} // 静态方法
  void baz() {} // 实例方法
}

void main() {
  var x;

  // 比较顶级函数
  x = foo;
  assert(foo === x);

  // 比较静态函数
  x = A.bar;
  assert(A.bar == x);

  // 比较实例方法
  var v = A();
  var w = A();
  var y = w；
  x= w.bar;

  // 两个闭包引用的同一实例（2号）,
  // 所以它们相等。
  assert(y.baz == x);

  // 两个闭包引用的非同一个实例，
  // 所以它们不相等。
  assert(v.baz != w.baz);
}

```

### 返回值

- 所有函数都会返回一个值。 如果没有明确指定返回值， 函数体会被隐式的添加 return null; 语句。
